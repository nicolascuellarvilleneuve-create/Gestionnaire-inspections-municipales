import{c,u as f,r,j as e}from"./index-DbTyyhW_.js";import{C as j,T as g}from"./trash-2-Dyv2AAGh.js";const y=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],v=c("shield-alert",y);const N=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],w=c("shield",N);const k=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],C=c("user-plus",k);const A=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],S=c("users",A),M=()=>{const{user:h,getToken:a}=f(),[o,m]=r.useState([]),[t,l]=r.useState({username:"",password:"",role:"inspector"}),[u,d]=r.useState(""),n=r.useCallback(async()=>{try{const s=await fetch("http://localhost:3001/api/auth/users",{headers:{Authorization:`Bearer ${a()}`}}),i=await s.json();s.ok&&m(i)}catch{console.error("Failed to load users")}},[a]);r.useEffect(()=>{n()},[n]);const p=async s=>{s.preventDefault();try{const i=await fetch("http://localhost:3001/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a()}`},body:JSON.stringify(t)}),x=await i.json();i.ok?(d(`Utilisateur ${x.user.username} créé !`),l({username:"",password:"",role:"inspector"}),n()):d(`Erreur: ${x.error}`)}catch{d("Erreur serveur")}},b=async s=>{if(window.confirm("Supprimer cet utilisateur ?"))try{await fetch(`http://localhost:3001/api/auth/users/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${a()}`}}),n()}catch{alert("Erreur")}};return h?.role!=="admin"?e.jsx("div",{className:"p-8 text-center text-red-500",children:"Accès Refusé. Admin seulement."}):e.jsxs("div",{className:"max-w-6xl mx-auto p-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-800 mb-8 flex items-center",children:[e.jsx(w,{className:"mr-3 text-blue-600"})," Administration Urbk"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200 h-fit",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-700 mb-4 flex items-center",children:[e.jsx(C,{size:20,className:"mr-2"})," Créer un Utilisateur"]}),u&&e.jsx("div",{className:"mb-4 text-sm font-medium text-blue-600 bg-blue-50 p-2 rounded",children:u}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Identifiant"}),e.jsx("input",{type:"text",value:t.username,onChange:s=>l({...t,username:s.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Mot de passe"}),e.jsx("input",{type:"password",value:t.password,onChange:s=>l({...t,password:s.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Rôle"}),e.jsxs("select",{value:t.role,onChange:s=>l({...t,role:s.target.value}),className:"w-full p-2 border rounded-lg bg-slate-50",children:[e.jsx("option",{value:"inspector",children:"Inspecteur"}),e.jsx("option",{value:"admin",children:"Administrateur"})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 transition",children:"Créer Compte"})]})]}),e.jsxs("div",{className:"md:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 px-6 py-4 border-b border-slate-100 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-700 flex items-center",children:[e.jsx(S,{size:20,className:"mr-2"})," Utilisateurs Actifs"]}),e.jsxs("span",{className:"text-xs font-bold bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:["Total: ",o.length]})]}),e.jsxs("div",{className:"divide-y divide-slate-100",children:[o.map(s=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-slate-50 transition",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white mr-4 ${s.role==="admin"?"bg-purple-500":"bg-green-500"}`,children:s.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-800",children:s.username}),e.jsxs("div",{className:"text-xs text-slate-500 uppercase tracking-wider flex items-center mt-1",children:[s.role==="admin"?e.jsx(v,{size:12,className:"mr-1 text-purple-500"}):e.jsx(j,{size:12,className:"mr-1 text-green-500"}),s.role]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-xs text-slate-400 hidden sm:block",children:["Créé le: ",new Date(s.created_at).toLocaleDateString()]}),e.jsx("button",{onClick:()=>b(s.id),className:"text-slate-400 hover:text-red-600 transition p-2 rounded-full hover:bg-red-50",title:"Supprimer l'utilisateur",children:e.jsx(g,{size:18})})]})]},s.id)),o.length===0&&e.jsx("div",{className:"p-8 text-center text-slate-400 italic",children:"Aucun utilisateur trouvé."})]})]})]})]})};export{M as default};
